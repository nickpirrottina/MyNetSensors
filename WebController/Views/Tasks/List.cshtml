@using MyNetSensors.NodesTasks
@model IEnumerable<MyNetSensors.NodesTasks.NodeTask>


@{
    if (ViewBag.description == null)
    {
        ViewBag.Title = "Tasks";
    }
    else
    {
        ViewBag.Title = "Tasks for " + @ViewBag.description;
    }
}


@if (ViewBag.description == null)
{
    <br />
}

<div class="ui container">

    @if (ViewBag.description != null)
    {
        <a asp-controller="Tasks" asp-action="Index" class="ui button right floated">Show tasks for all nodes</a>
    }


    <h2>@ViewBag.Title</h2>
    <p>
        < <a asp-controller="Dashboard" asp-action="Index">Dashboard</a>
    </p>
    <div class="ui divider"></div>

    <div class="ui raised segments">
        <div class="ui secondary clearing segment">
            <b>Tasks</b>
            <a asp-action="New" asp-route-id="@ViewBag.nodeId" asp-route-id2="@ViewBag.sensorId" class="ui right floated small primary button">New Task</a>
        </div>
        @if (Model == null || Model.Count() == 0)
        {
            <div class="ui attached segment">
                No tasks
            </div>
        }
        else
        {
            foreach (var task in Model)
            {
                <div class="ui attached clearing segment">


                    <h4>
                        Task @task.Id
                        @if (task.description != null)
                        {
                            @: : @task.description
                        }
                    </h4>
                    <div class="ui right floated basic tiny buttons">
                        @if (!task.isCompleted)
                        {
                            if (task.enabled)
                            {
                                <a asp-action="Disable" class="ui button" asp-route-id="@task.Id"><b>Disable</b></a>
                            }
                            else
                            {
                                <a asp-action="Enable" class="ui button" asp-route-id="@task.Id"><b>Enable</b></a>
                            }

                            if (task.isRepeating)
                            {
                                <a asp-action="ExecuteNow" class="ui button" asp-route-id="@task.Id"><b>Restart</b></a>
                            }
                            else
                            {
                                <a asp-action="ExecuteNow" class="ui button" asp-route-id="@task.Id"><b>Execute</b></a>
                            }
                        }
                        else
                        {
                            if (task.isRepeating)
                            {
                                <a asp-action="ExecuteNow" class="ui button" asp-route-id="@task.Id"><b>Restart</b></a>
                            }
                            else
                            {
                                <a asp-action="ExecuteNow" class="ui button" asp-route-id="@task.Id"><b>Execute</b></a>
                            }
                        }
                        <a asp-action="Edit" class="ui button" asp-route-id="@task.Id"><b>Edit</b></a>
                        <a asp-action="Remove" class="ui button" asp-route-id="@task.Id"><b>Delete</b></a>
                    </div>

                    @if (task.isCompleted)
                    {
                        <span class="ui tiny green ribbon label">COMPLETED</span>
                    }
                    else if (!task.enabled)
                    {
                        <span class="ui tiny ribbon label">DISABLED</span>
                    }
                    else
                    {
                        <span class="ui tiny blue ribbon label">ACTIVE</span>
                    }
                    <br />
                    <br/>
                    @task.sensorDescription<br>

                    Execution date: @task.executionDate<br>
                    Set value:@task.executionValue<br>
                    @if (task.isRepeating)
                    {
                        @:Repeat values: @task.repeatingAValue / @task.repeatingBValue<br>
                        @:Repeat interval: @task.repeatingInterval<br>
                        @:Executions done:@task.repeatingDoneCount<br>
                        if (task.repeatingNeededCount > 0)
                        {
                            @:Executions left:@(task.repeatingNeededCount - task.repeatingDoneCount)<br>
                        }

                    }
                </div>
            }
            <div class="ui right aligned attached segment">
                <div class="ui small buttons">
                <a asp-controller="Tasks" asp-action="RemoveAll" asp-route-id="@ViewBag.nodeId" asp-route-id2="@ViewBag.sensorId" class="ui button">Delete all</a>
                    <a asp-controller="Tasks" asp-action="RemoveCompleted" asp-route-id="@ViewBag.nodeId" asp-route-id2="@ViewBag.sensorId" class="ui primary button">Delete completed</a>
                    </div>
            </div>
        }
    </div>
</div>

<br/>
